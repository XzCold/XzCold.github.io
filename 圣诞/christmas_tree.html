<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Magical Christmas Tree</title>
    <style>
        :root {
            --primary-glow: 0 0 10px rgba(255, 71, 87, 0.6);
            --glass-bg: rgba(20, 20, 20, 0.6);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            /* æ›´æœ‰è´¨æ„Ÿçš„å¾„å‘æ¸å˜èƒŒæ™¯ */
            background: radial-gradient(circle at 50% 30%, #2c3e50 0%, #0f2027 100%);
            height: 100dvh; /* ä½¿ç”¨ dvh è§£å†³æ‰‹æœºæµè§ˆå™¨åœ°å€æ è·³åŠ¨é—®é¢˜ */
            width: 100vw;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            touch-action: none; /* ç¦æ­¢é»˜è®¤è§¦æ§è¡Œä¸º */
        }

        /* === 1. å¯åŠ¨å°é¢ (è§£å†³éŸ³ä¹è‡ªåŠ¨æ’­æ”¾é™åˆ¶) === */
        #start-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            transition: opacity 0.8s;
        }
        
        #start-btn {
            padding: 15px 40px;
            font-size: 20px;
            background: linear-gradient(45deg, #ff4757, #ff6b81);
            color: white;
            border: none;
            border-radius: 50px;
            box-shadow: 0 0 20px rgba(255, 71, 87, 0.5);
            cursor: pointer;
            animation: pulseBtn 2s infinite;
        }

        @keyframes pulseBtn {
            0% { transform: scale(1); box-shadow: 0 0 20px rgba(255, 71, 87, 0.5); }
            50% { transform: scale(1.05); box-shadow: 0 0 40px rgba(255, 71, 87, 0.8); }
            100% { transform: scale(1); box-shadow: 0 0 20px rgba(255, 71, 87, 0.5); }
        }

        /* === 2. åœºæ™¯å…ƒç´  === */
        #snow-canvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .main-container {
            position: relative;
            height: 100%;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            padding-bottom: 140px; /* ä¸ºåº•éƒ¨æ§åˆ¶æ ç•™å‡ºç©ºé—´ */
        }

        /* æ ‘çš„å®¹å™¨ï¼šé™åˆ¶æœ€å¤§å®½é«˜ï¼Œä¿æŒæ¯”ä¾‹ */
        .tree-wrapper {
            position: relative;
            height: 85%; /*åœ¨å¤§å±ä¸‹é«˜ä¸€ç‚¹*/
            width: auto;
            aspect-ratio: 3/4; /* ä¿æŒå›¾ç‰‡å¤§æ¦‚æ¯”ä¾‹ */
            max-width: 95vw;
            /* åªæœ‰ç‚¹å‡»æ ‘çš„åŒºåŸŸæ‰æœ‰æ•ˆ */
            cursor: crosshair;
            z-index: 5;
        }
        
        /* é’ˆå¯¹å°å±æ‰‹æœºçš„è°ƒæ•´ */
        @media (max-width: 600px) {
            .tree-wrapper {
                height: 70%; 
                width: 90%;
            }
        }

        #tree-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            /* ç»™å›¾ç‰‡åŠ ä¸€ä¸ªæŸ”å’Œçš„å‘å…‰æŠ•å½±ï¼Œæå‡èåˆåº¦ */
            filter: drop-shadow(0 0 15px rgba(255,255,255,0.2));
        }

        /* === 3. ç¯å…‰ä¸ç‰¹æ•ˆ === */
        .light {
            position: absolute;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            transform: translate(-50%, -50%) scale(0);
            /* æ ¸å¿ƒç¾æœ¯å‡çº§ï¼šå†…å‘å…‰+å¤–è¾‰å…‰ï¼Œæ›´æœ‰LEDè´¨æ„Ÿ */
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.9), currentColor 60%);
            box-shadow: 0 0 10px currentColor, 0 0 20px currentColor; 
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards, breathe 2s infinite alternate ease-in-out 0.4s;
            pointer-events: none;
            z-index: 10;
        }

        @keyframes popIn { to { transform: translate(-50%, -50%) scale(1); } }
        @keyframes breathe {
            0% { opacity: 0.8; transform: translate(-50%, -50%) scale(0.95); filter: brightness(1); }
            100% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); filter: brightness(1.3); }
        }

        /* ç‚¹å‡»æ—¶çš„ç²’å­çˆ†ç‚¸ç‰¹æ•ˆ */
        .spark {
            position: absolute;
            width: 4px; height: 4px;
            background: white;
            border-radius: 50%;
            pointer-events: none;
            z-index: 15;
            animation: explode 0.8s ease-out forwards;
        }
        @keyframes explode {
            0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
        }

        /* æ˜Ÿæ˜Ÿå…‰æ™• */
        .star-halo {
            position: absolute;
            top: 6%; left: 50%;
            transform: translate(-50%, -50%);
            width: 120px; height: 120px;
            background: radial-gradient(circle, rgba(255,215,0,0.4) 0%, transparent 70%);
            animation: rotateHalo 10s linear infinite;
            pointer-events: none;
            z-index: 4;
            mix-blend-mode: screen;
        }
        @keyframes rotateHalo { from{transform:translate(-50%, -50%) rotate(0deg);} to{transform:translate(-50%, -50%) rotate(360deg);} }

        /* === 4. æ¯›ç»ç’ƒæ§åˆ¶æ  (UIå‡çº§) === */
        .glass-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 500px;
            padding: 15px;
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 100;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }

        /* èƒ¶å›ŠæŒ‰é’®æ ·å¼ */
        .btn {
            flex: 1;
            padding: 10px 0;
            border: none;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 600;
            color: rgba(255,255,255,0.9);
            background: rgba(255,255,255,0.1);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .btn:active { transform: scale(0.95); }
        .btn.primary { background: rgba(255, 71, 87, 0.8); box-shadow: 0 4px 15px rgba(255, 71, 87, 0.3); }
        .btn.active { background: rgba(255, 255, 255, 0.9); color: #333; box-shadow: 0 0 15px rgba(255,255,255,0.5); }
        
        #music-toggle {
            width: 40px; height: 40px; flex: none; border-radius: 50%;
            font-size: 18px; background: rgba(30, 144, 255, 0.8);
        }
        #music-toggle.playing {
            background: #f1c40f; color: #333;
            animation: spin 3s linear infinite;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        .hint-text {
            color: rgba(255,255,255,0.5);
            font-size: 12px;
            text-align: center;
            margin-top: -5px;
        }
        
        /* æ­Œè¯åŠ¨æ•ˆ */
        .lyrics-box {
            position: absolute;
            bottom: 150px; /* åœ¨æ§åˆ¶æ ä¸Šæ–¹ */
            width: 100%;
            text-align: center;
            pointer-events: none;
            z-index: 20;
        }
        .lyric-line {
            display: inline-block;
            padding: 5px 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
            color: #f1c40f;
            font-size: 16px;
            font-weight: bold;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .lyric-line.show { opacity: 1; transform: translateY(0); }

    </style>
</head>
<body>

    <div id="start-screen">
        <div style="font-size: 40px; margin-bottom: 20px;">ğŸ„</div>
        <button id="start-btn" onclick="startExperience()">å¼€å¯åœ£è¯é­”æ³•</button>
        <p style="color: #ccc; margin-top: 15px; font-size: 12px;">å»ºè®®å¼€å¯å£°éŸ³ä½“éªŒæ›´ä½³</p>
    </div>

    <audio id="bgm" loop>
        <source src="music.mp3" type="audio/mpeg">
    </audio>

    <canvas id="snow-canvas"></canvas>

    <div class="main-container">
        <div class="tree-wrapper" id="click-area">
            <div class="star-halo"></div>
            <img src="å¾®ä¿¡å›¾ç‰‡_20251225225217_76_79.jpg" id="tree-img" alt="åœ£è¯æ ‘" onerror="alert('å›¾ç‰‡åŠ è½½å¤±è´¥ï¼è¯·ç¡®ä¿æ–‡ä»¶åæ˜¯: å¾®ä¿¡å›¾ç‰‡_20251225225217_76_79.jpg')">
        </div>
        
        <div class="lyrics-box"><div id="lyric-text" class="lyric-line">Magic is loading...</div></div>
    </div>

    <div class="glass-controls">
        <div class="hint-text">ç‚¹å‡»æ ‘èº«æŒ‚ç¯ï¼Œåˆ‡æ¢ä¸»é¢˜æ”¹å˜æ°›å›´ âœ¨</div>
        <div class="row">
            <button id="music-toggle" onclick="toggleMusic()">ğŸµ</button>
            <button class="btn primary" onclick="autoDecorate()">ğŸ ä¸€é”®è£…é¥°</button>
            <button class="btn" style="background:rgba(255,255,255,0.2)" onclick="clearScene()">ğŸ—‘ï¸ æ¸…ç©º</button>
        </div>
        <div class="row">
            <button class="btn active theme-btn" onclick="switchTheme('multi', this)">ğŸŒˆ å½©è™¹</button>
            <button class="btn theme-btn" onclick="switchTheme('gold', this)">âœ¨ æš–é‡‘</button>
            <button class="btn theme-btn" onclick="switchTheme('ice', this)">â„ï¸ å†°é›ª</button>
        </div>
    </div>

    <script>
        // === 1. åˆå§‹åŒ–ä¸å¯åŠ¨é€»è¾‘ ===
        const audio = document.getElementById('bgm');
        const startScreen = document.getElementById('start-screen');
        const musicBtn = document.getElementById('music-toggle');
        let isStarted = false;

        function startExperience() {
            // ç”¨æˆ·ä¸»åŠ¨ç‚¹å‡»ï¼Œè§£é”éŸ³é¢‘ç¯å¢ƒ
            startScreen.style.opacity = '0';
            setTimeout(() => { startScreen.remove(); }, 800);
            
            audio.volume = 0.6;
            audio.play().then(() => {
                musicBtn.classList.add('playing');
                showLyric("Merry Christmas! ğŸ¶");
            }).catch(e => console.log("Audio play error", e));
            
            isStarted = true;
            // å¯åŠ¨åè‡ªåŠ¨ç”Ÿæˆä¸€ç‚¹é›ªèŠ±ä½œä¸ºå¼€åœº
            autoDecorate(10); 
        }

        function toggleMusic() {
            if (audio.paused) {
                audio.play();
                musicBtn.classList.add('playing');
                showLyric("Music On ğŸµ");
            } else {
                audio.pause();
                musicBtn.classList.remove('playing');
                showLyric("Music Off ğŸ”‡");
            }
        }

        // === 2. æ ¸å¿ƒäº¤äº’ï¼šæŒ‚ç¯ä¸ç‰¹æ•ˆ ===
        const treeArea = document.getElementById('click-area');
        
        // ä¸»é¢˜é…è‰²è¡¨
        const themes = {
            'multi': ['#ff4757', '#2ed573', '#ffa502', '#3742fa', '#e056fd', '#ffffff'],
            'gold': ['#ffd32a', '#fffa65', '#ff9f43', '#ffffff', '#fff200'],
            'ice': ['#00d2d3', '#48dbfb', '#c7ecee', '#ffffff', '#54a0ff']
        };
        let currentTheme = 'multi';

        // ç»‘å®šç‚¹å‡»/è§¦æ‘¸äº‹ä»¶ (ä½¿ç”¨ pointerdown å…¼å®¹æ€§æœ€å¥½)
        treeArea.addEventListener('pointerdown', function(e) {
            e.preventDefault(); // é˜²æ­¢åŒå‡»ç¼©æ”¾
            // è®¡ç®—ç›¸å¯¹åæ ‡
            const rect = treeArea.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // åªæœ‰ç‚¹å‡»åœ¨å®¹å™¨å†…æ‰ç”Ÿæˆ
            if (x >= 0 && x <= rect.width && y >= 0 && y <= rect.height) {
                createLight(x, y);
                createSparkles(e.clientX, e.clientY); // ç”Ÿæˆç²’å­ç‰¹æ•ˆ
            }
        });

        function createLight(x, y) {
            const light = document.createElement('div');
            light.className = 'light';
            
            const colors = themes[currentTheme];
            const color = colors[Math.floor(Math.random() * colors.length)];
            
            light.style.color = color; // box-shadow ä½¿ç”¨ currentColor
            // éšæœºå¤§å°å¾®è°ƒï¼Œæ›´è‡ªç„¶
            const size = 12 + Math.random() * 6; 
            light.style.width = size + 'px';
            light.style.height = size + 'px';
            
            light.style.left = x + 'px';
            light.style.top = y + 'px';
            
            treeArea.appendChild(light);
        }

        // ç²’å­çˆ†ç‚¸ç‰¹æ•ˆ
        function createSparkles(screenX, screenY) {
            for(let i=0; i<8; i++) {
                const spark = document.createElement('div');
                spark.className = 'spark';
                document.body.appendChild(spark);
                
                spark.style.left = screenX + 'px';
                spark.style.top = screenY + 'px';
                
                // éšæœºé£æº…æ–¹å‘
                const angle = Math.random() * Math.PI * 2;
                const distance = 30 + Math.random() * 30;
                const tx = Math.cos(angle) * distance + 'px';
                const ty = Math.sin(angle) * distance + 'px';
                
                spark.style.setProperty('--tx', tx);
                spark.style.setProperty('--ty', ty);
                
                setTimeout(() => spark.remove(), 800);
            }
        }

        // === 3. åŠŸèƒ½é€»è¾‘ï¼šä¸»é¢˜åˆ‡æ¢ä¸ä¸€é”®è£…é¥° ===
        
        function switchTheme(themeName, btnElement) {
            currentTheme = themeName;
            
            // UIæ›´æ–°
            document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
            btnElement.classList.add('active');
            
            // æ ¸å¿ƒä¿®å¤ï¼šç«‹å³æ›´æ–°ç°æœ‰çš„ç¯
            const existingLights = treeArea.querySelectorAll('.light');
            const colors = themes[themeName];
            
            existingLights.forEach(light => {
                const newColor = colors[Math.floor(Math.random() * colors.length)];
                light.style.transition = 'color 0.3s, background 0.3s';
                light.style.color = newColor;
                // é‡ç½®ä¸€ä¸‹åŠ¨ç”»è®©å®ƒçœ‹èµ·æ¥åƒé‡æ–°ç‚¹äº®
                light.style.animation = 'none';
                light.offsetHeight; /* è§¦å‘é‡ç»˜ */
                light.style.animation = 'breathe 2s infinite alternate ease-in-out';
            });
            
            showLyric(`Theme: ${btnElement.innerText}`);
        }

        function autoDecorate(count = 30) {
            const w = treeArea.offsetWidth;
            const h = treeArea.offsetHeight;
            
            for(let i=0; i<count; i++) {
                setTimeout(() => {
                    // ç®€å•çš„ä¸‰è§’å½¢åˆ†å¸ƒæ¨¡æ‹Ÿ
                    const factor = Math.random(); 
                    const x = (w/2) + (Math.random()-0.5) * (w * 0.8 * factor);
                    const y = h * 0.15 + (1-factor) * (h * 0.7);
                    createLight(x, y);
                }, i * 40);
            }
        }

        function clearScene() {
            const lights = treeArea.querySelectorAll('.light');
            lights.forEach(l => l.remove());
        }

        // === 4. æ­Œè¯æç¤ºç³»ç»Ÿ ===
        const lyricEl = document.getElementById('lyric-text');
        let lyricTimer;
        function showLyric(text) {
            lyricEl.innerText = text;
            lyricEl.classList.add('show');
            clearTimeout(lyricTimer);
            lyricTimer = setTimeout(() => {
                lyricEl.classList.remove('show');
            }, 2500);
        }

        // === 5. é«˜æ€§èƒ½é£˜é›ª Canvas ===
        const canvas = document.getElementById('snow-canvas');
        const ctx = canvas.getContext('2d');
        let width = window.innerWidth;
        let height = window.innerHeight;
        canvas.width = width;
        canvas.height = height;
        
        const flakes = Array.from({length: 60}, () => ({
            x: Math.random() * width,
            y: Math.random() * height,
            r: Math.random() * 2 + 1,
            v: Math.random() * 1 + 0.5,
            a: Math.random() * 0.5 + 0.2
        }));

        function drawSnow() {
            ctx.clearRect(0, 0, width, height);
            ctx.fillStyle = '#fff';
            
            flakes.forEach(f => {
                f.y += f.v;
                if(f.y > height) f.y = -5;
                
                ctx.globalAlpha = f.a;
                ctx.beginPath();
                ctx.arc(f.x, f.y, f.r, 0, Math.PI*2);
                ctx.fill();
            });
            requestAnimationFrame(drawSnow);
        }
        drawSnow();
        
        window.onresize = () => {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        };

    </script>
</body>
</html>